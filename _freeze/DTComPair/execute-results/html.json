{
  "hash": "d8a96ecc07e57c57e5b8145215889ac9",
  "result": {
    "engine": "knitr",
    "markdown": "# 诊断模型的准确性比较\n\n可以计算和比较的诊断准确性指标是灵敏度、特异性、阳性和阴性预测值以及阳性和阴性诊断似然比。\n\n## 单检验与金标准比较\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(DTComPair)\nlibrary(flextable)\nlibrary(tidyverse)\ndata(Paired1) # Hypothetical study data\nhead(Paired1)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|  d| y1| y2|\n|--:|--:|--:|\n|  1|  1|  1|\n|  1|  1|  1|\n|  1|  1|  1|\n|  1|  1|  1|\n|  1|  1|  1|\n|  1|  1|  1|\n\n</div>\n:::\n\n```{.r .cell-code}\na1 <- tab.1test(d = d, y = y1, data = Paired1)\nprint(a1)\n#> Binary diagnostic test 'y1'\n#> \n#>           Diseased Non-diseased Total\n#> Test pos.      397           84   481\n#> Test neg.       54          177   231\n#> Total          451          261   712\na1 |> acc.1test(method.ci = \"waldci\") # default Wald intervals\n#> Diagnostic accuracy of test 'y1'\n#> \n#> (Estimates, standard errors and 95%-confidence intervals)\n#> \n#>                  Est.         SE  Lower CL  Upper CL\n#> Sensitivity 0.8802661 0.01528718 0.8503038 0.9102284\n#> Specificity 0.6781609 0.02891782 0.6214830 0.7348388\n#> PPV         0.8253638 0.01731081 0.7914353 0.8592924\n#> NPV         0.7662338 0.02784617 0.7116563 0.8208113\n#> \n#>            Est.  SE (log)  Lower CL  Upper CL\n#> PDLR  2.7351124 0.0915147 2.2860079 3.2724472\n#> NDLR  0.1765568 0.1346088 0.1356142 0.2298601\n```\n:::\n\n\n\n\n\n## 两检验比较\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nb1 <- tab.paired(d = d, y1 = y1, y2 = y2, data = Paired1)\nprint(b1)\n#> Two binary diagnostic tests (paired design)\n#> \n#> Test1: 'y1'\n#> Test2: 'y2'\n#> \n#> Diseased:\n#>            Test1 pos. Test1 neg. Total\n#> Test2 pos.        319         22   341\n#> Test2 neg.         78         32   110\n#> Total             397         54   451\n#> \n#> Non-diseased:\n#>            Test1 pos. Test1 neg. Total\n#> Test2 pos.         31         22    53\n#> Test2 neg.         53        155   208\n#> Total              84        177   261\nb1 |> acc.paired(method.ci = \"scoreci\") # Wilson intervals\n#> Diagnostic accuracy of test 'y1'\n#> \n#> (Estimates, standard errors and 95%-confidence intervals)\n#> \n#>                  Est. SE Lower CL Upper CL\n#> Sensitivity 0.8802661 NA   0.8470   0.9071\n#> Specificity 0.6781609 NA   0.6193   0.7319\n#> PPV         0.8253638 NA   0.7889   0.8567\n#> NPV         0.7662338 NA   0.7076   0.8162\n#> \n#>            Est.  SE (log)  Lower CL  Upper CL\n#> PDLR  2.7351124 0.0915147 2.2860079 3.2724472\n#> NDLR  0.1765568 0.1346088 0.1356142 0.2298601\n#> \n#> ----------------------------------------------------------\n#> Diagnostic accuracy of test 'y2'\n#> \n#> (Estimates, standard errors and 95%-confidence intervals)\n#> \n#>                  Est. SE Lower CL Upper CL\n#> Sensitivity 0.7560976 NA   0.7144   0.7935\n#> Specificity 0.7969349 NA   0.7440   0.8413\n#> PPV         0.8654822 NA   0.8282   0.8957\n#> NPV         0.6540881 NA   0.6002   0.7042\n#> \n#>            Est.  SE (log)  Lower CL  Upper CL\n#> PDLR  3.7234238 0.1255060 2.9114648 4.7618247\n#> NDLR  0.3060507 0.0885996 0.2572629 0.3640906\n\n# \"weighted generalized score statistic (wgs)\"进行检验\npv.wgs(b1)\n#> $ppv\n#>          test1          test2           diff test.statistic        p.value \n#>     0.82536383     0.86548223     0.04011841     5.46588745     0.01939120 \n#> \n#> $npv\n#>          test1          test2           diff test.statistic        p.value \n#>   7.662338e-01   6.540881e-01  -1.121457e-01   1.653540e+01   4.775012e-05 \n#> \n#> $method\n#> [1] \"weighted generalized score statistic (wgs)\"\n```\n:::\n\n\n\n\n\n## 函数结果导出\n\n两检验比较结果生成word导出\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npaired_analysis <- function(data, d, y1, y2) {\n  # 创建配对布局\n  paired.layout <- tab.paired(d = data |> pull(d), y1 = data |> pull(y1), y2 = data |> pull(y2), data = data)\n\n  # 灵敏度和特异度使用McNemar配对卡方检验\n  mcnem.results <- sesp.mcnemar(paired.layout)\n\n  # PPV和NPV使用加权广义分数统计量\n  wgs.results <- pv.wgs(paired.layout)\n\n  # 整合结果\n  results <-\n    mcnem.results$sensitivity |>\n    bind_rows(mcnem.results$specificity) |>\n    bind_rows(wgs.results$ppv) |>\n    bind_rows(wgs.results$npv)\n\n  # 添加测试信息\n  output <-\n    results |>\n    mutate(test = glue::glue(\"test1 = {y1} vs test2 = {y2}\")) |>\n    add_column(index = c(\"sensitivity\", \"specificity\", \"ppv\", \"npv\")) |>\n    relocate(test, index)\n\n  return(output)\n}\n\npaired_analysis(data = Paired1, d = \"d\", y1 = \"y1\", y2 = \"y2\") |>\n  as_flextable(max_row = 10, show_coltype = F) |>\n  colformat_double(digits = 3)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"tabwid\"><style>.cl-92422904{}.cl-922eee70{font-family:'Arial';font-size:11pt;font-weight:normal;font-style:normal;text-decoration:none;color:rgba(0, 0, 0, 1.00);background-color:transparent;}.cl-9236b736{margin:0;text-align:left;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9236b74a{margin:0;text-align:right;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);padding-bottom:5pt;padding-top:5pt;padding-left:5pt;padding-right:5pt;line-height: 1;background-color:transparent;}.cl-9236fee4{width:1.856in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236feee{width:0.947in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236fef8{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236fef9{width:1.083in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff02{width:0.778in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 1.5pt solid rgba(102, 102, 102, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff03{width:1.856in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff04{width:0.947in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff0c{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff16{width:1.083in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff17{width:0.778in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff20{width:1.856in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff21{width:0.947in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff22{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff2a{width:1.083in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff2b{width:0.778in;background-color:transparent;vertical-align: middle;border-bottom: 0 solid rgba(0, 0, 0, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff34{width:1.856in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff35{width:0.947in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff3e{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff3f{width:1.083in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff40{width:0.778in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff48{width:1.856in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff49{width:0.947in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff52{width:0.75in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff53{width:1.083in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}.cl-9236ff54{width:0.778in;background-color:transparent;vertical-align: middle;border-bottom: 1.5pt solid rgba(102, 102, 102, 1.00);border-top: 0 solid rgba(0, 0, 0, 1.00);border-left: 0 solid rgba(0, 0, 0, 1.00);border-right: 0 solid rgba(0, 0, 0, 1.00);margin-bottom:0;margin-top:0;margin-left:0;margin-right:0;}</style><table data-quarto-disable-processing='true' class='cl-92422904'><thead><tr style=\"overflow-wrap:break-word;\"><th class=\"cl-9236fee4\"><p class=\"cl-9236b736\"><span class=\"cl-922eee70\">test</span></p></th><th class=\"cl-9236feee\"><p class=\"cl-9236b736\"><span class=\"cl-922eee70\">index</span></p></th><th class=\"cl-9236fef8\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">test1</span></p></th><th class=\"cl-9236fef8\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">test2</span></p></th><th class=\"cl-9236fef8\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">diff</span></p></th><th class=\"cl-9236fef9\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">test.statistic</span></p></th><th class=\"cl-9236ff02\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">p.value</span></p></th></tr></thead><tbody><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-9236ff03\"><p class=\"cl-9236b736\"><span class=\"cl-922eee70\">test1 = y1 vs test2 = y2</span></p></td><td class=\"cl-9236ff04\"><p class=\"cl-9236b736\"><span class=\"cl-922eee70\">sensitivity</span></p></td><td class=\"cl-9236ff0c\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.880</span></p></td><td class=\"cl-9236ff0c\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.756</span></p></td><td class=\"cl-9236ff0c\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">-0.124</span></p></td><td class=\"cl-9236ff16\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">31.360</span></p></td><td class=\"cl-9236ff17\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.000</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-9236ff20\"><p class=\"cl-9236b736\"><span class=\"cl-922eee70\">test1 = y1 vs test2 = y2</span></p></td><td class=\"cl-9236ff21\"><p class=\"cl-9236b736\"><span class=\"cl-922eee70\">specificity</span></p></td><td class=\"cl-9236ff22\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.678</span></p></td><td class=\"cl-9236ff22\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.797</span></p></td><td class=\"cl-9236ff22\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.119</span></p></td><td class=\"cl-9236ff2a\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">12.813</span></p></td><td class=\"cl-9236ff2b\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.000</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-9236ff03\"><p class=\"cl-9236b736\"><span class=\"cl-922eee70\">test1 = y1 vs test2 = y2</span></p></td><td class=\"cl-9236ff04\"><p class=\"cl-9236b736\"><span class=\"cl-922eee70\">ppv</span></p></td><td class=\"cl-9236ff0c\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.825</span></p></td><td class=\"cl-9236ff0c\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.865</span></p></td><td class=\"cl-9236ff0c\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.040</span></p></td><td class=\"cl-9236ff16\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">5.466</span></p></td><td class=\"cl-9236ff17\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.019</span></p></td></tr><tr style=\"overflow-wrap:break-word;\"><td class=\"cl-9236ff34\"><p class=\"cl-9236b736\"><span class=\"cl-922eee70\">test1 = y1 vs test2 = y2</span></p></td><td class=\"cl-9236ff35\"><p class=\"cl-9236b736\"><span class=\"cl-922eee70\">npv</span></p></td><td class=\"cl-9236ff3e\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.766</span></p></td><td class=\"cl-9236ff3e\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.654</span></p></td><td class=\"cl-9236ff3e\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">-0.112</span></p></td><td class=\"cl-9236ff3f\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">16.535</span></p></td><td class=\"cl-9236ff40\"><p class=\"cl-9236b74a\"><span class=\"cl-922eee70\">0.000</span></p></td></tr></tbody><tfoot><tr style=\"overflow-wrap:break-word;\"><td  colspan=\"7\"class=\"cl-9236ff48\"><p class=\"cl-9236b736\"><span class=\"cl-922eee70\">n: 4</span></p></td></tr></tfoot></table></div>\n```\n\n:::\n:::",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"site_libs/tabwid-1.1.3/tabwid.css\" rel=\"stylesheet\" />\n<script src=\"site_libs/tabwid-1.1.3/tabwid.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}